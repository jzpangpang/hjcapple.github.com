---
title: 《编程珠玑》笔记和习题 - 第1章
layout: post
published: true

---

这一章让我想起之前读过的文章[X-Y问题](http://coolshell.cn/articles/10804.html)。

习题
-------
### 1. 如果不缺内存，如何使用一个具有库的语言来实现一种排序算法以表示和排序集合？
C 使用 qsort, C++ 使用 std::sort。

### 2. 如何使用位逻辑运算 (如与、或、移位)来实现位向量?
可以参考之前写的文章[C/C++ 中的位运算](http://hjcapple.github.io/2007/02/27/cpp-bit-operations.html)。
位运算，每个C/C++程序员都应该熟悉。也可以使用C++的标准库std::bitset。

### 3. 运行时效率是设计目标的一个重要组成部分，所得到的程序需要足够高效。在你自己的系统上实现位图排序并度量其运行时间。该时间与系统排序的运行时间以及习题1中排序的运行时间相比如何？假设n为1000000，且输入文件包含1000000个整数。
boost库有类，boost::progress_timer 可以测量并打印出时间，位于<boost/progress.hpp>头文件中。

### 4. 如果认真考虑了习题3，你将会面对生成小于n且没有重复的k个整数的问题。最简单的方法就是使用前k个正整数。这个极端的数据集合将不会明显地改变位图方法的运行时间，但是可能会歪曲系统排序的运行时间。如何生成位于0至n-1之间的k个不同的随机顺序的随机整数？尽量使你的程序简短且高效。

书中答案: 见第12章，尤其是习题12.8。下面的代码假定randint(l, u)返回l..u中的一个随机整数。

	for i = [0, n)
		x[i] = i
		
	for i = [0, k)
		swap(i, randint(i, n-1))
		print x[i]
其中swap函数的作用是交换x中的两个元素。有关randint函数的详细讨论见12.1节。

PS: 在C++中，常常使用前封后闭区间[a, b), 从0开始数数，这样会更加自然。randint(l, u)设计成返回[l, u)之间的整数会更好一点，这样的话就可以直接调用，randint(i, n), 不用传n-1了。

### 5.那个程序员说他有1MB的可用存储空间，但是我们概要描述的代码需要1.25MB的空问。他可以不费力气地索取到额外的空间。如果1MB空问是严格的，你会推荐如何处理呢？你的算法的运行时间又是多少?
书中答案: 使用位图表示1000万个数需要1000万个位，或者说125万字节。考虑到没有以数字 0或1打头的电话号码，我们可以将内存需求降低为100万字节。另一种做法是采用两趟算法，首先使用5000000/8=625000个字的存储空间来排序0~4999999之间的整数，然后在第二趟排序5000000-999999的整数。k趟算法可以在kn的时问开销和n/k空问开销内完成对最多n小于n的无重复正整数的排序。

### 6. 如果那个程序员说的不是每个整数最多出现一次，而是每个整数最多出现10次，你又如何建议他呢？你的解决方案如何随着可用存储空问总量的变化而变化?
书中答案: 如果每个整数最多出现10次，那么我们就可以使用4位的半字节来统计它出现的次数。利用习题5的答案,我们可以使用10000000/2个字节在 1趟内完成对整个文件的排序，或使用 10000000/2k个字节在k趟内完成对整个文件的排序。

### 9. 使用更多空间来换取更少的运行时间存在一个问题：初始化空间本身需要消耗大量的时间。说明如何设计一种技术，在第一次访问向量的项时将其初始化为0。你的方案应该使用常量时间进行初始化和向量访问，使用的额外空间应正比于向量的大小。因为该方法通过进一步增加空间来减少初始化的时间，所以仅仅在空间上很便宜、时问很宝贵且向量很稀疏的情况下才考虑使用。
书中答案: 借助于两个额外的 n 元向量 from、to 和一个整数top，我们就可以使用标识来初始 化向量 data[0 .. n-1]。如果元素data[i]己初始化，那么from[i] < top 并且to[from[i]] = i。 因此，from是一个简单的标识，to和top 一起确保了from中不会被写入内存里的随机内容。下图data的空白项未被初始化:

![init-data](/media/files/pearls/init_data.png)

变量top初始为0,下面的代码实现对数组元素j的首次访问：

	from[i] = top
	to[top] = i
	data[i] = 0
	top++
本习题和答案来自 Aho、Hopcroft 和 Ullman 编写的 Design and Analysis Computer Algorithms (Addison-Wcsley出版社1974年出版)中的习题2.12。习题结合了关键字索引和巧妙的标识方法、适用于矩阵和向量。

PS: 这个答案不太好理解，需要还原一下思路。初始化data费时间，data最开始时就是随机值，当访问data[i]的时候，需要一种方式来判断data[i]是否已经被初始化。

to向量记录下每个被初始化数据的索引值，top变量表示已经有多少个数据被初始化了。当依次访问data[1], data[5], data[3], 数据索引为1,5,3，所以就有

	to[0] = 1
	to[1] = 5
	to[2] = 3
	
当需要判断data[i]是否被初始化，就是判断i是否放在to[0, top)中，其实这里可以使用一个线性查找，一个个判断。但这样速度就很慢了。

为加快判断速度，加入向量from，直接定位到to中的唯一可能的位置。而只有to向量时，只能线性查找。

比如需要判断data[3]是否已经被初始化，就是判断3是否在to[0, top)中。使用from来加速，从from[3]中取得数字2，这样就直接定位到to的可能位置to[2], 再来判断to[2]是否等于3。是的话data[3]就已经被初始化了。

因为from最开始也是没有被初始化的，这样toIdx = from[i], 就可能出现toIdx>=top, 这表示访问top的话数组越界了。另外可能就是top[toIdx] != i, 而top[toIdx]是i的唯一可能出现位置，两数不相等，i也就不在to[0, top)中，因此data[i]也没有被初始化。

### 10. 在成本低廉的隔日送达时代之前，商店允许顾客通过电话订购商品，并在几天后上门。商店的数据库使用客户的电话号码作为其检索的主关键字 (客户知道他们自己的电话号码，而且这些关键字几乎都是唯一的)。你如何组织商店的数据库，以允许高效的插入和检索操作？

书中答案: 商店将纸质订单表格放在 10× 10的箱数组中，使用客户电话号码的最后两位作为散列索引。当客户打电话下订单时，将订单放到适当的箱中。当客户来取商品时，销售人员顺序搜索对应箱中的订单——这就是经典的 “用顺序搜索来解决冲突的开放散列”。电话号码的最后两位数字非常接近于随机，因此是非常理想的散列函数，而最前面的两位数字则很不理想——为什么？一些市政机关使用类似的方案在记事本中记录信息。

PS: 感觉这个题目和答案用了大量术语，反而将简单事情搞复杂了。数据库指一堆箱子，箱子应该也是贴上标签的，排成10*10方便找到对应箱子。有订单了，就将订单扔到对应箱子。

电话号码从大到小进行编号，最前面数字可能代表运营商，次之可能代表城市之类。所以越靠前越可能重复。平时我们这边也是使用手机尾数的。

### 11. 在20世纪80年代早期，洛克希德公司加利福尼亚州桑尼维尔市工厂的工程师们每天都要将许多由计算机辅助设计 (CAD)系统生成的图纸从工厂送到位于圣克鲁斯市的测试站。虽然仅有40公里远，但使用汽车快递服务每天都需要一个多小时的时间 (由于交通阻塞和山路崎岖),花费100美元。请给出新的数据传输方案并估计每一种方案的费用。

书中答案: 两地的计算机原先是通过微波连接的，但是当时测试站打印图纸所需的打印机却非常昂贵。因此,该团队在主厂绘制图纸，然后拍摄下来并通过信鸽把35毫米的底片送到测试站，在测试站进行放大并打印成图片。鸽子来回一次需要45分钟，是汽车所需时间的一半，并且每天只需要花费几美元。在项目开发的16个月中，信鸽传送了几百卷底片，仅丢失了两卷 (当地有鹰，因此没有让信鸽传送机密数据）。由于现在打印机比较便宜，因此可以使用微波链路解决该问题。

PS: 有莫名的喜感。突然想起那句“永远不要忽略一辆载满磁带的在高速公路上飞驰的卡车的带宽”。

### 12. 载人航天的先驱们很快就意识到需要在外太空的极端环境下实现顺利书写。民间盛传美国国家宇航局(NASA)花费100万美元研发出了一种特殊的钢笔来解决这个问题。那么，前苏联又会如何解决相同的问题呢?
书中答案: 根据该传间，前苏联人用铅笔解决了这个问题。有关这个真实故事的背景请查看www.spacepen.com。Fisher Space Pen公司成立于1948年，其书写设各被俄国航天局、水底探测人员和喜马拉雅登山探险队使用过。

PS: 就算前苏联人使用铅笔，也不会是普通的铅笔。普通的铅笔使用石墨作为笔芯，写字的时候会出现粉尘或者笔芯会折断。这样石墨粉尘或者断了的笔芯在真空中漂浮，进入宇航员的眼睛或者仪器中（石墨会导电），有可能会引起一系列事故。

我们总是推崇小聪明，而不是从根本解决问题，这是不可取的。关于小聪明还有个流传很久的故事，工厂有条生产线，将肥皂放进盒子中，有时肥皂放不进盒子，就需要检测出空盒子。美国公司的做法是研制一些科技，比如扫描盒子是否为空，跟着使用机器人手臂将空盒子检出来。中国小工厂的做法是，在生产线中放个风扇，吹走空盒子。很多根据这个，就得出美国公司的做法太浪费钱，太笨。

我不知道那个故事是不是真的。美国公司的做法有个好处，是从根本解决了问题。当不是生成肥皂，改成生产其它东西，比如生成电饭锅了，它之前的解决方案可以移过来用。而中国那种小聪明做法作为权宜之计是很好的，但不值得过分推崇。

小聪明不是很通用，宁愿要一种笨笨的感觉。



